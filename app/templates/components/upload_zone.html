{#
画像アップロードゾーンコンポーネント

使用方法:
{% from 'components/upload_zone.html' import upload_zone %}
{{ upload_zone() }}

機能:
- カメラ撮影（モバイル優先）
- ファイル選択
- ドラッグ&ドロップ
- バリデーション（JPEG, PNG, WebP / 10MB以下）
- プレビュー表示
#}

{% macro upload_zone() %}
<div x-data="uploadZone()" class="upload-zone w-full">
    <!-- カメラ撮影ボタン（モバイル優先） -->
    <div class="mb-6 md:hidden">
        <label class="btn-primary cursor-pointer w-full flex items-center justify-center gap-3
                      bg-gradient-to-r from-primary to-primary-light text-white
                      font-semibold py-4 px-6 rounded-xl
                      shadow-lg hover:shadow-xl shadow-primary/20
                      active:scale-95 transition-all duration-200">
            <input type="file" name="image" accept="image/*" capture="environment" aria-label="カメラでメニューを撮影"
                @change="handleFileSelect($event)" class="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span class="text-lg">カメラで撮影</span>
        </label>
    </div>

    <!-- ドラッグ&ドロップエリア -->
    <div class="drop-zone border-2 border-dashed rounded-xl p-8 md:p-12 text-center
                transition-all duration-300 relative overflow-hidden group"
        :class="isDragging ? 'border-primary bg-primary/10' : 'border-slate-700 bg-surface/50 hover:border-slate-500 hover:bg-surface'"
        @dragenter.prevent="isDragging = true" @dragover.prevent="isDragging = true"
        @dragleave.prevent="isDragging = false" @drop.prevent="handleDrop($event)">

        <div class="flex flex-col items-center gap-4 relative z-10">
            <div class="w-20 h-20 rounded-full bg-surface border border-slate-700 flex items-center justify-center mb-2 shadow-inner group-hover:scale-110 transition-transform duration-300 pointer-events-none"
                :class="isDragging ? 'scale-110 border-primary text-primary' : 'text-slate-400'">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                </svg>
            </div>

            <div class="space-y-1 pointer-events-none">
                <p class="text-xl font-medium text-slate-200">
                    画像をここにドラッグ&ドロップ
                </p>
                <p class="text-slate-400">
                    または
                </p>
            </div>

            <label class="cursor-pointer relative z-20">
                <span
                    class="inline-block py-2 px-6 rounded-full bg-slate-700 hover:bg-slate-600 text-white text-sm font-medium transition-colors border border-slate-600 hover:border-slate-500">
                    ファイルを選択
                </span>
                <input type="file" name="image" accept=".jpg,.jpeg,.png,.webp" aria-label="メニュー画像を選択"
                    @change="handleFileSelect($event)" class="hidden">
            </label>
        </div>
    </div>

    <!-- プレビュー -->
    <div x-show="preview" x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 translateY-4" x-transition:enter-end="opacity-100 translateY-0"
        class="mt-6">
        <div class="relative group rounded-xl overflow-hidden border border-white/10 shadow-2xl">
            <img :src="preview" :alt="'プレビュー: ' + (file?.name || 'アップロード画像')"
                class="w-full h-auto max-h-[400px] object-contain bg-black/50 backdrop-blur-sm">

            <div
                class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center p-6">
                <button @click="clearFile" type="button"
                    class="bg-red-500/80 hover:bg-red-600 backdrop-blur-md text-white px-6 py-2 rounded-full font-medium shadow-lg hover:shadow-red-500/20 transition-all transform hover:scale-105 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    画像を削除
                </button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}