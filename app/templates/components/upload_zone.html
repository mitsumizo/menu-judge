{#
画像アップロードゾーンコンポーネント

使用方法:
    {% from 'components/upload_zone.html' import upload_zone %}
    {{ upload_zone() }}

機能:
    - カメラ撮影（モバイル優先）
    - ファイル選択
    - ドラッグ&ドロップ
    - バリデーション（JPEG, PNG, WebP / 10MB以下）
    - プレビュー表示
#}

{% macro upload_zone() %}
<div x-data="uploadZone()" class="upload-zone w-full max-w-2xl mx-auto">
    <!-- カメラ撮影ボタン（モバイル優先） -->
    <div class="mb-4">
        <label class="btn-primary cursor-pointer inline-block w-full text-center
                      bg-gradient-to-r from-primary to-blue-600 text-white
                      font-semibold py-3 px-6 rounded-lg
                      shadow-lg hover:shadow-xl
                      transform hover:scale-105
                      transition-all duration-200">
            <input type="file"
                   accept="image/*"
                   capture="environment"
                   aria-label="カメラでメニューを撮影"
                   @change="handleFileSelect($event)"
                   class="hidden">
            <span class="text-xl">📷</span>
            <span class="ml-2">メニューを撮影</span>
        </label>
    </div>

    <!-- ドラッグ&ドロップエリア -->
    <div class="drop-zone border-2 border-dashed rounded-xl p-8 text-center
                transition-all duration-300"
         :class="isDragging ? 'border-primary bg-primary/10' : 'border-slate-600 bg-surface'"
         @dragenter.prevent="isDragging = true"
         @dragover.prevent="isDragging = true"
         @dragleave.prevent="isDragging = false"
         @drop.prevent="handleDrop($event)">

        <div class="flex flex-col items-center gap-3">
            <div class="text-4xl" :class="isDragging ? 'animate-bounce' : ''">
                📁
            </div>

            <p class="text-slate-300 font-medium">
                画像をドラッグ&ドロップ
            </p>

            <p class="text-sm text-slate-400">
                または
            </p>

            <label class="btn-secondary cursor-pointer inline-block
                          bg-secondary text-white
                          font-semibold py-2 px-6 rounded-lg
                          shadow hover:shadow-lg
                          transform hover:scale-105
                          transition-all duration-200">
                <input type="file"
                       accept=".jpg,.jpeg,.png,.webp"
                       aria-label="メニュー画像を選択"
                       @change="handleFileSelect($event)"
                       class="hidden">
                ファイルを選択
            </label>

            <p class="text-xs text-slate-500 mt-2">
                対応形式: JPEG, PNG, WebP（最大10MB）
            </p>
        </div>
    </div>

    <!-- プレビュー -->
    <div x-show="preview"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         class="mt-6">
        <div class="bg-surface rounded-xl p-4 shadow-lg border border-slate-700">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-semibold text-slate-200">プレビュー</h3>
                <button @click="clearFile"
                        class="btn-danger bg-red-600 hover:bg-red-700
                               text-white font-semibold py-2 px-4 rounded-lg
                               shadow hover:shadow-lg
                               transition-all duration-200">
                    削除
                </button>
            </div>

            <!-- プレビュー画像とローディングオーバーレイ -->
            <div class="relative" :class="isUploading ? 'opacity-75' : ''">
                <img :src="preview"
                     alt="アップロード画像のプレビュー"
                     class="max-h-64 w-auto mx-auto rounded-lg shadow-md">

                <!-- アップロード中のオーバーレイ -->
                <div x-show="isUploading"
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="opacity-0"
                     x-transition:enter-end="opacity-100"
                     class="absolute inset-0 flex items-center justify-center bg-black/50 rounded-lg">
                    <div class="text-center">
                        <svg class="animate-spin h-12 w-12 text-white mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="text-white text-sm font-semibold">解析中...</p>
                    </div>
                </div>
            </div>

            <!-- アップロードボタン -->
            <div class="mt-4">
                <button @click="uploadFile"
                        :disabled="isUploading"
                        class="w-full bg-accent hover:bg-amber-600
                               disabled:bg-slate-600 disabled:cursor-not-allowed
                               text-white font-semibold py-3 px-6 rounded-lg
                               shadow-lg hover:shadow-xl
                               transition-all duration-200">
                    <span x-show="!isUploading">解析を開始</span>
                    <span x-show="isUploading" class="flex items-center justify-center gap-2">
                        <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span>解析中...</span>
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}
